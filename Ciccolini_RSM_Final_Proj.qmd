---
title: "Final Project"
author:
  - Skylar Ciccolini
format: 
  html:
    embed-resources: true
---

## Instructions

For the final project for Randomization and Simulation, you will analyze a dataset and write the methods and results sections as you would for a manuscript. Ideally, you would use a dataset you are working on analyzing and intending to publish but you can use any dataset if you don't have one like that right now. If you've done a similar analysis for another module in QMLS2, you should use that same dataset here.

Your data and analysis doesn't have to be overly complicated, and if your actual data would demand a more complex model than we have used (e.g., multilevel or non-linear), feel free to simplify the data for the purposes of analysis.

You should restrict your writing to the methods about the analysis you have done. You do not need to include the other parts of the methods describing the experiment, etc. Just include enough to know what questions you are answering and/or what hypotheses you are testing. The same is true for your results section. Simply write the sections describing the results of the analyses you do here. The entire thing should be written in this `.qmd` file, formatting the analysis, plots, etc. here. 

Things to include:

- The hypotheses to be tested
- The sampling strategy
- Your main results including empirical p-values
- Relevant figures
    - Although you might not include all these figures in a manuscript, they could very easily go into supplemental information.



## Set Up

Read in data and clean
```{r}
library(pacman)
p_load(tidyverse)

tick_23 <- read_csv("raw_data/tickdrag2023_clean.csv") |> 
  filter(YearColl == 2023) |> 
  select(Plot, Count, Species_Name) |> 
  mutate(Species_Name = case_when(
    Species_Name == "Dermacentor variabilis" ~ "DV",
    Species_Name == "Amblyomma americanum" ~ "AA",
    Species_Name == "Amblyomma maculatum" ~ "AM",
    Species_Name == "Dermacentor andersoni" ~ "DA"
  )) |> 
  filter(Species_Name != "NA") |> 
  uncount(weights = Count)





```

Plot Species Curve

```{r}
sm <- function(Plot, nsps, pres){
  ms <- 1:Plot
  out <- rep(NA, length(ms))
  for(mm in ms){
    ss <- 0
    for(ii in 1:length(nsps)){
      ss <- ss+ (1- choose((Plot - pres[ii]), mm) / choose(Plot, mm))
    }
    out[mm] <- ss
  }
  return(out)
}

Plot <- 5
pres <- c(5, 5, 5, 5)
nsps <- c(1769, 108, 86, 817)

nsps <- tick_23 |> group_by(Species_Name) |>
  tally()

pres <- tick_23 |> group_by(Species_Name) |>
  summarise("pres" = length(unique(Plot)))


out <- sm(Plot, nsps, pres)

oo <- tibble("plot" = 1:5,
             "Sp" = out)

oo |>
  ggplot(aes(plot, Sp)) +
  geom_point() +
  scale_x_continuous(breaks = 1:5) +
  labs(x = "Quadrat Number", y = "Species")

```


## Randomize

```{r}

sm <- function(Plot, nsps, pres){
  ms <- 1:Plot
  out <- rep(NA, length(ms))
  for(mm in ms){
    ss <- 0
    for(ii in 1:length(nsps)){
      ss <- ss+ (1- choose((Plot - pres[ii]), mm) / choose(Plot, mm))
    }
    out[mm] <- ss
  }
  return(out)
}

Plot <- 5

nsps <- tick_23 |> group_by(Species_Name) |>
  tally()

pres <- tick_23 |> group_by(Species_Name) |>
  summarise("pres" = length(unique(Plot)))


niter <- 10000

tick_23.s <- tick_23

out.s <- matrix(data = NA, nrow = niter, ncol = Plot)

for(ii in 1:niter){
  
  tick_23.s$Plot <- sample(1:Plot, size = nrow(tick_23), replace = TRUE)
  
  nsps <- tick_23.s |> 
    count(Species_Name)
  
  pres <- tick_23.s |> 
    group_by(Species_Name) |>
    summarise("pres" = length(unique(Plot)))
  
  out.s[ii,] <- sm(Plot, nsps$n, pres$pres)
  
}
```

## Visualize the curves

```{r}
out.st <- t(out.s)
out.st <- as.data.frame(out.st)
out.st$Plot <- 1:5
out.tib <- pivot_longer(out.st, -Plot,
                        names_to = "Iter",
                        values_to = "Sp")

  ggplot() +
  geom_line(data = out.tib, aes(Plot, Sp, group = Iter), alpha = 1/16) +
  geom_line(data = oo, aes(quadrat, Sp), color = "red") +
  scale_x_continuous(breaks = 1:10) +
  labs(x = "Quadrat Number", y = "Species") ## well, I got a curve, but I'm pretty sure my data is not working...
```














