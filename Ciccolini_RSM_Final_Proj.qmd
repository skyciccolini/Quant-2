---
title: "Final Project"
author:
  - Skylar Ciccolini
format: 
  html:
    embed-resources: true
---

## Hypothesis
I want to test whether or not the ticks are clustered in plots, or are randomly distributed.

## Sampling Strategy
First, I created a function that would calculate the species curve for ticks collected across 5 different plots. I then simulated 1000 species curves by randomizing the plots that the ticks were collected in. I calculated the empirical p values using a function that counted the number of times that the true species curve was less than the simulated curves (for each plot).

## Results
By visually comparing the original species curve to the simulated curves, it seems like my data is pretty different than the simulated data; especially in plots 1 and 2. It seems like the ticks are exhibiting a non-random distribution at my study site. The empirical p values that I calculated for each plot also support this as plots 1 and 2 have lower p values and plots 3-5 have higher p values.

## Randomly generate some data

```{r}
library(tidyverse)
tick <- tibble("Plot" = c(rep(1, 6),
                              rep(2, 8),
                              rep(3, 4),
                              rep(4, 9),
                              rep(5, 9)),
                "Species_Name" = c("AA", rep("DV", 3),
                              rep("AA", 4),
                              rep("DV", 3),
                              rep("AM", 5), rep("DA", 3), rep("DA", 5), "DV",
                              "AM", rep("DA", 3),
                              "DA",
                              rep("DA", 2), rep("AA", 2), rep("DV", 2)))
```


## Plot Species Curve

```{r}
sm <- function(quads, nsps, pres){
  ms <- 1:quads
  out <- rep(NA, length(ms))
  for(mm in ms){
    ss <- 0
    for(ii in 1:length(nsps)){
      ss <- ss+ (1- choose((quads - pres[ii]), mm) / choose(quads, mm))
    }
    out[mm] <- ss
  }
  return(out)
}

tick |> group_by(Species_Name) |>
  tally()

tick |> group_by(Species_Name) |>
  summarise("pres" = length(unique(Plot)))

quads <- 5
pres <- c(3, 3, 3, 4) 
nsps <- c(7, 6, 14, 9)


out <- sm(quads, nsps, pres)

oo <- tibble("quads" = 1:5,
             "Sp" = out)

oo |>
  ggplot(aes(quads, Sp)) +
  geom_point() +
  scale_x_continuous(breaks = 1:5) +
  labs(x = "Quad Number", y = "Species")

```



## Randomize

```{r}

niter <- 1000

tick.s <- tick

out.s <- matrix(data = NA, nrow = niter, ncol = quads)


for (ii in 1:niter) {
 tick.s$Plot <- sample(1:quads, size = nrow(tick), replace = TRUE)

  nsps <- tick.s |>  
    count(Species_Name)
  
  pres <- tick.s |>  
    group_by(Species_Name) |> 
    summarise("pres" = length(unique(Plot)))
  
  out.s[ii,] <- sm(quads, nsps$n, pres$pres)

}
```



## Visualize the curves

```{r}
out.st <- t(out.s)
out.st <- as.data.frame(out.st)
out.st$Plot <- 1:5
out.tib <- pivot_longer(out.st, -Plot,
                        names_to = "Iter",
                        values_to = "Sp")

  ggplot() +
  geom_line(data = out.tib, aes(Plot, Sp, group = Iter), alpha = 1/16) +
  geom_line(data = oo, aes(quads, Sp), color = "red") +
  scale_x_continuous(breaks = 1:5) +
  labs(x = "Plot Number", y = "Species")
```


## P values

```{r}
# Initialize vector to store p values per column
p_vals <- numeric(ncol(out.s))

# Loop over columns (plots)
for (ii in 1:ncol(out.s)) {
  # pull out sm values for plot
  sim_col <- out.s[, ii]
  
  # number of times sim is greater than real data
  num_successes <- sum(out[ii] >= sim_col)
  
  # Empirical p value for this column
  p_vals[ii] <- num_successes / length(sim_col)
}



```













